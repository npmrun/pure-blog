---
import DocTreeSelf from "./DocTreeSelf.astro"
import {githubNewURL, githubURL} from "@blog/config"
import { betterDirectorySort } from "@blog/utils/better-directory-sort"
export type One = {
  name: string
  data?: any
  children: One[]
}

export interface Props {
  list: One[]
}

const { list } = Astro.props as Props

function isActive(url: string){
  return decodeURIComponent(Astro.url.pathname.replace(/\/$/, '')).startsWith(url);
}

const showList = list.sort((a, b) => {
  return betterDirectorySort(
    { name: a.name, isDirectory: !a.data },
    { name: b.name, isDirectory: !b.data },
  );
});
---

{showList.map(v=>{
    const url = v.path
    return <details open={isActive(v.active)}>
      <summary class:list={[isActive(v.active)?'active':'']}>
        {!v.data && <><span title={v.name} class:list={["tree-item"]}>{v.name}</span><a target="_blank" href={githubNewURL+url} class="op">新建</a></>}
        {!!v.data && <><a rel={isActive(v.active)?"":"prefetch"} href={v.data.url} title={v.name} class:list={["tree-item tree-md-file"]}>{v.name}</a><a target="_blank" href={githubURL + v.filePath} class="op">编辑</a></>}
      </summary>
      {Array.isArray(v.children) && <Astro.self list={v.children} />}
    </details>
  })}